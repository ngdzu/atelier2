graph LR
    subgraph "User Actions"
        UA1[User Clicks Time Slot]
        UA2[User Creates Appointment]
        UA3[User Views Calendar]
        UA4[User Drags Appointment]
        UA5[User Filters Calendar]
    end

    subgraph "Frontend Layer"
        F1[React Components]
        F2[React Query]
        F3[Calendar Service]
        F4[Form Validation]
    end

    subgraph "API Layer"
        A1[Express Routes]
        A2[Authentication Middleware]
        A3[Authorization Middleware]
        A4[Validation Middleware]
        A5[Error Middleware]
    end

    subgraph "Application Layer"
        AP1[Calendar Service]
        AP2[Appointment Service]
        AP3[Export Service]
        AP4[Conflict Detection]
        AP5[Availability Check]
    end

    subgraph "Domain Layer"
        D1[Appointment Entity]
        D2[Business Rules]
        D3[Status Transitions]
        D4[Validation Logic]
    end

    subgraph "Infrastructure Layer"
        I1[Appointment Repository]
        I2[Calendar Repository]
        I3[Database Query Builder]
    end

    subgraph "Database"
        DB[(PostgreSQL)]
    end

    UA1 --> F1
    UA2 --> F1
    UA3 --> F1
    UA4 --> F1
    UA5 --> F1

    F1 --> F2
    F1 --> F3
    F1 --> F4

    F2 --> F3
    F3 --> A1

    A1 --> A2
    A2 --> A3
    A3 --> A4
    A4 --> AP1
    A4 --> AP2
    A4 --> AP3

    AP1 --> AP4
    AP1 --> AP5
    AP2 --> AP4
    AP2 --> AP5

    AP1 --> D1
    AP2 --> D1
    AP4 --> D2
    AP5 --> D2

    D1 --> D2
    D2 --> D3
    D2 --> D4

    AP1 --> I1
    AP1 --> I2
    AP2 --> I1
    AP3 --> I1

    I1 --> I3
    I2 --> I3
    I3 --> DB

    DB --> I3
    I3 --> I1
    I3 --> I2
    I1 --> AP1
    I2 --> AP1
    I1 --> AP2

    AP1 --> A5
    AP2 --> A5
    AP3 --> A5
    A5 --> F3
    F3 --> F2
    F2 --> F1

    style UA1 fill:#e1f5ff
    style UA2 fill:#e1f5ff
    style UA3 fill:#e1f5ff
    style UA4 fill:#e1f5ff
    style UA5 fill:#e1f5ff
    style DB fill:#fce4ec

