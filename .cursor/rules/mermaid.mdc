---
description: apply to mermaid diagram and charts,  typically files with .mmd extensions
alwaysApply: false
---

# Mermaid Diagram Guidelines

## Overview

Mermaid diagrams (`.mmd` files) are used to create visual representations of system architecture, workflows, user flows, and other diagrams. This document outlines the rules and best practices for managing Mermaid diagrams in this project.

## Core Rules

### 1. SVG File Requirement

**Every Mermaid diagram file (`.mmd`) MUST have a corresponding SVG file (`.svg`) with the same name.**

- **File Naming**: If you have `diagram.mmd`, you must also have `diagram.svg`
- **Location**: Both files should be in the same directory
- **Example**: 
  - ✅ `doc/diagrams/dashboard-system-context.mmd` → `doc/diagrams/dashboard-system-context.svg`
  - ❌ `doc/diagrams/dashboard-system-context.mmd` without corresponding SVG

### 2. SVG Generation

**Whenever a `.mmd` file is created or updated, the corresponding `.svg` file MUST be regenerated.**

- **Before Committing**: Always regenerate SVG files after editing MMD files
- **Automation**: Use the provided script to generate SVGs (see Scripts section below)
- **Manual Generation**: If needed, use `npx @mermaid-js/mermaid-cli` directly

### 3. Markdown File References

**When referencing Mermaid diagrams in Markdown files, always reference the SVG file, not the MMD file.**

- **Display Format**: Use standard Markdown image syntax to display the SVG
- **Example**:
  ```markdown
  ## System Architecture
  
  ![System Context Diagram](diagrams/dashboard-system-context.svg)
  ```
- **Why SVG**: SVG files can be displayed directly in Markdown viewers, GitHub, and documentation tools without requiring Mermaid rendering support

### 4. Version Control

**Both `.mmd` and `.svg` files should be committed to version control.**

- **Commit Together**: Always commit both files together when making changes
- **Keep in Sync**: Ensure SVG files are always up-to-date with their corresponding MMD files
- **Review**: When reviewing PRs, verify that SVG files match their MMD sources

## Workflow

### Creating a New Diagram

1. **Create the `.mmd` file** with your Mermaid diagram code
2. **Generate the `.svg` file** using the script or CLI tool
3. **Reference the SVG** in your Markdown documentation
4. **Commit both files** together

### Updating an Existing Diagram

1. **Edit the `.mmd` file** with your changes
2. **Regenerate the `.svg` file** (the script will overwrite the existing SVG)
3. **Verify the SVG** renders correctly
4. **Update documentation** if the diagram structure changed significantly
5. **Commit both files** together

### Best Practices

- **Test MMD Syntax**: Verify your Mermaid syntax is valid before generating SVG
- **Review SVG Output**: Check that the generated SVG looks correct
- **Keep Diagrams Simple**: Complex diagrams may not render well; break them into smaller diagrams if needed
- **Use Descriptive Names**: Name your diagrams clearly (e.g., `dashboard-user-roles.mmd` not `diagram1.mmd`)

## Scripts

### Generate All SVGs

Run the script to generate SVG files for all MMD files in the project:

```bash
# From project root
node scripts/generateMermaidSvgs.js

# Or if using npm script (if added to package.json)
npm run generate:diagrams
```

The script will:
- Find all `.mmd` files in the project
- Generate corresponding `.svg` files in the same directory
- Report any errors or missing files

### Generate Single SVG

To generate a single SVG file:

```bash
# Using npx (no installation needed)
npx @mermaid-js/mermaid-cli -i doc/diagrams/dashboard-system-context.mmd -o doc/diagrams/dashboard-system-context.svg

# Or using the script with a specific file
node scripts/generateMermaidSvgs.js doc/diagrams/dashboard-system-context.mmd
```

## Markdown Integration Examples

### Basic Image Reference

```markdown
## Architecture Overview

![System Context](diagrams/dashboard-system-context.svg)
```

### With Caption (using HTML figure tag)

```markdown
<figure>
  <img src="diagrams/dashboard-user-roles.svg" alt="User Roles Diagram" />
  <figcaption>Figure 1: User roles and permissions in the dashboard system</figcaption>
</figure>
```

### In Documentation Sections

```markdown
## Diagrams

### System Context
![System Context Diagram](diagrams/dashboard-system-context.svg)

### User Roles
![User Roles Diagram](diagrams/dashboard-user-roles.svg)

### Feature Overview
![Feature Overview Diagram](diagrams/dashboard-feature-overview.svg)
```

## Troubleshooting

### SVG Not Generating

- **Check Mermaid Syntax**: Validate your MMD file syntax at https://mermaid.live/
- **Check Node.js**: Ensure Node.js is installed (required for mermaid-cli)
- **Check Dependencies**: Run `npm install` if using local dependencies

### SVG Not Displaying in Markdown

- **Check File Path**: Ensure the path to the SVG is correct (relative to the Markdown file)
- **Check File Exists**: Verify the SVG file exists in the expected location
- **Check File Format**: Ensure the file is a valid SVG (open it in a browser to verify)

### SVG Out of Sync

- **Regenerate**: Run the generation script to update all SVGs
- **Check Timestamps**: Compare modification times of MMD and SVG files
- **Verify Changes**: Ensure MMD changes are reflected in the SVG

## Tools

### Required Tools

- **Node.js**: Required for running mermaid-cli
- **@mermaid-js/mermaid-cli**: Used via `npx` (no installation needed) or can be installed globally

### Installation (Optional)

```bash
# Install globally (optional)
npm install -g @mermaid-js/mermaid-cli

# Or use npx (recommended, no installation needed)
npx @mermaid-js/mermaid-cli --version
```

## Checklist

When working with Mermaid diagrams:

- [ ] Created/updated `.mmd` file
- [ ] Generated corresponding `.svg` file
- [ ] Verified SVG renders correctly
- [ ] Updated Markdown files to reference the SVG
- [ ] Committed both `.mmd` and `.svg` files together
- [ ] Verified SVG displays correctly in documentation

## Related Documentation

- [Viewing Mermaid Diagrams Guide](../doc/VIEWING_MERMAID_DIAGRAMS.md) - How to view and preview Mermaid diagrams in Cursor IDE
- [Documentation Guidelines](.cursor/rules/documentation_guidelines.mdc) - General documentation maintenance guidelines
- [Mermaid Documentation](https://mermaid.js.org/) - Official Mermaid documentation

---

**Remember**: Always keep your SVG files in sync with your MMD files. Out-of-sync diagrams can cause confusion and documentation errors.
